var Assets;!function(e){var t=function(){function e(e){this.configObject=e}return e.prototype.getFonts=function(e,t){var n=new Options.getFontOptions,i=this.createGetFontUrl(n);this.handleRequest(i,e,t)},e.prototype.getFontsToJsonFormat=function(e,t,n){var i=this.createGetFontUrl(e,"json");this.handleRequest(i,t,n)},e.prototype.getFontsToXmlFormat=function(e,t,n){var i=this.createGetFontUrl(e);this.handleRequest(i,t,n)},e.prototype.getRecipesToXml=function(e,t,n){var i=new Options.getRecipesOptions;n&&(i.IsSorted=n);var o=this.createGetRecipesUrl(i);this.handleRequest(o,e,t)},e.prototype.getRecipesToJson=function(e,t,n){var i=new Options.getRecipesOptions;i.Format="json",n&&(i.IsSorted=n);var o=this.createGetRecipesUrl(i);this.handleRequest(o,e,t)},e.prototype.createGetFontUrl=function(e,t){"undefined"==typeof t&&(t="xml");var n=this.configObject.url+"List/Fonts?format="+t;return e.Type&&(n+="&type="+e.Type),e.IsSorted&&(n+="&issorted="+e.IsSorted),n},e.prototype.createGetRecipesUrl=function(e){var t=e.Format?e.Format:"xml",n=this.configObject.url+"List/Recipes?format="+t;return e.IsSorted&&(n+="&issorted="+e.IsSorted),n},e.prototype.handleRequest=function(e,t,n){var i=this.createCORSRequest("GET",e);i?i.send():n("Your browser deos not support ajax calls"),i.onreadystatechange=function(){if(4==i.readyState&&200==i.status){var e=i.response;t&&t(e)}else 4==i.readyState&&404==i.status?n&&n("Server not found"):4==i.readyState&&500==i.status&&n&&n("Internal server error")}},e.prototype.createCORSRequest=function(e,t){var n,i=new XMLHttpRequest;if("withCredentials"in i)n=i,n.open(e,t,!0);else if("undefined"!=typeof XDomainRequest){var o=new XDomainRequest;n=o,i.open(e,t)}else n=null;return n},e}();e.AssetsManager=t}(Assets||(Assets={}));var Options;!function(e){var t=function(){function e(){this.Text=null,this.Type=null,this.Font=null,this.Height=null,this.WidthCompression=null,this.Justification=null,this.Envelope=null,this.Recipe=null,this.X1=null,this.X2=null,this.Y1=null,this.Y2=null,this.Decoration=null,this.Neendle=null,this.MachineFormat=null,this.TransformationOptions=null,this.Palette=null}return e}();e.LetteringOptions=t;var n=function(){function e(){this.Angle=null,this.Scale=null,this.OffsetX=null,this.OffsetY=null,this.ResetOrigin=null}return e}();e.TransformationOptions=n;var i=function(){function e(){this.IsSorted=null,this.Type=null}return e}();e.getFontOptions=i;var o=function(){function e(){this.Format=null,this.IsSorted=null}return e}();e.getRecipesOptions=o;var r=function(){function e(){this.Design=null,this.Name=null,this.Text=null,this.TextColour=null}return e}();e.Peronalization=r;var s=function(){function e(){this.Layout=null,this.MachineFormat=null,this.Needles=null,this.Palette=null,this.Recipe=null,this.StackedAlignment=null,this.StackedSpacing=null,this.TransformationOptions=null,this.CompoundElements=null}return e}();e.CompoundOptions=s;var a=function(){function e(){this.File=null,this.palette=null,this.needles=null}return e}();e.DesignOptions=a;var l=function(){function e(){this.Design=null,this.Letteting=null}return e}();e.CompoundElements=l}(Options||(Options={}));var Renderer;!function(e){var t=function(){function e(e){this.confObject=e}return e.prototype.lettering=function(e,t,n,i){var o=!1;if(e.Palette)for(var r=0;r<e.Palette.length;r++)if(!/(^[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(e.Palette[r])){o=!0;break}o&&i&&i("Invalid color"),o&&(e.Palette=null);var s=this.createLetteringUrl(e);if(t){var a=document.getElementById(t);a&&a.setAttribute("src",s)}n&&n(s)},e.prototype.letteringTextFontColor=function(e,t,n,i,o,r){var s=new Options.LetteringOptions;s.Text=e,s.Font=t;var a=!1;if(n)for(var l=0;l<n.length;l++)if(!/(^[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(n[l])){a=!0;break}a&&r("Invalid color."),n&&!a&&(s.Neendle=0,s.Palette=n),this.lettering(s,i,o,null)},e.prototype.letteringBase64=function(e,t,n){var i=!1;if(e.Palette)for(var o=0;o<e.Palette.length;o++)if(!/(^[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(e.Palette[o])){i=!0;break}if(i&&n&&n("Invalid colors"),!i){var r=this.createLetteringUrl(e);this.GetBase64Image(r,t,n)}},e.prototype.letteringTextFontColorBase64=function(e,t,n,i,o){var r=new Options.LetteringOptions;r.Text=e,r.Font=t;var s=!1;if(n)for(var a=0;a<n.length;a++)if(!/(^[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(n[a])){s=!0;break}s&&o&&o("Invalid color."),n&&!s&&(r.Neendle=0,r.Palette=n);var l=this.createLetteringUrl(r);this.GetBase64Image(l,i,o)},e.prototype.template=function(e,t,n,i){var o=this.createTemplateUrl(e,i);if(t){var r=document.getElementById(t);r&&r.setAttribute("src",o)}n&&n(o)},e.prototype.templateBase64=function(e,t,n,i){var o=this.createTemplateUrl(e,i);this.GetBase64Image(o,t,n)},e.prototype.design=function(e,t,n,i,o,r,s){var a=!1;if(n)for(var l=0;l<n.length;l++)if(!/(^[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(n[l])){a=!0;break}a&&s&&s("Invalid color");var f=a?null:n,c=this.createDesignUrl(e,f,i,o);if(t){var p=document.getElementById(t);p&&p.setAttribute("src",c)}r&&r(c)},e.prototype.designChangePalette=function(e,t,n,i,o){this.design(e,t,n,null,null,i,o)},e.prototype.designChangeNeedles=function(e,t,n,i,o){this.design(e,t,null,n,null,i,o)},e.prototype.designBase64=function(e,t,n,i,o,r){var s=!1;if(t)for(var a=0;a<t.length;a++)if(!/(^[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(t[a])){s=!0;break}if(s&&r&&r("Invalid color"),!s){var l=this.createDesignUrl(e,t,n,i);this.GetBase64Image(l,o,r)}},e.prototype.designChangePaletteBase64=function(e,t,n,i){var o=!1;if(t)for(var r=0;r<t.length;r++)if(!/(^[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(t[r])){o=!0;break}if(o&&i&&i("Invalid color"),!o){var s=this.createDesignUrl(e,t,null,null);this.GetBase64Image(s,n,i)}},e.prototype.designChangeNeedlesBase64=function(e,t,n,i){var o=this.createDesignUrl(e,null,t,null);this.GetBase64Image(o,n,i)},e.prototype.compound=function(e,t){var n=this.createCompoundUrl(e);if(t){var i=document.getElementById(t);i&&i.setAttribute("src",n)}},e.prototype.compoundBase64=function(e,t,n){var i=this.createCompoundUrl(e);this.GetBase64Image(i,t,n)},e.prototype.GetBase64Image=function(e,t,n){var i=new Image,o="";i.src=e,i.onload=function(){var e=document.createElement("canvas");e.width=i.width,e.height=i.height;var n=e.getContext("2d");n.drawImage(i,0,0),o=e.toDataURL("image/png"),t&&t(o.replace(/^data:image\/(png|jpg);base64,/,""))},i.onerror=function(){n&&n("Image could not be loaded.")}},e.prototype.createLetteringUrl=function(e){var t=e.Text?e.Text:"ABC",n=this.confObject.url+"render/Lettering?Text="+t;if(e.Type&&(n+="&Type="+e.Type),e.Font&&(n+="&Font="+e.Font.replace(/\s/g,"%20")),e.Height&&(n+="&height="+e.Height),e.WidthCompression&&(n+="&WidthCompression="+e.WidthCompression),e.Justification&&(n+="&Justification="+e.Justification),e.Envelope&&(n+="&Envelope="+e.Envelope),e.Decoration&&"monogram"==e.Type.toLowerCase()&&(n+="&Decoration="+e.Decoration),e.Recipe&&(n+="&Recipe="+e.Recipe.replace(/\s/g,"%20")),e.Neendle&&(n+="&Needle="+e.Neendle),e.MachineFormat&&(n+="&MachineFormat="+e.MachineFormat.replace(/\s/g,"%20")),e.X1&&(n+="&X1="+e.X1),e.X2&&(n+="&X2="+e.X2),e.Y1&&(n+="&Y1="+e.Y1),e.Y2&&(n+="&Y2="+e.Y2),e.TransformationOptions&&(e.TransformationOptions.Angle&&(n+="&Angle="+e.TransformationOptions.Angle),e.TransformationOptions.Scale&&(n+="&Scale="+e.TransformationOptions.Scale),e.TransformationOptions.OffsetX&&(n+="&OffsetX="+e.TransformationOptions.OffsetX),e.TransformationOptions.OffsetY&&(n+="&OffsetY="+e.TransformationOptions.OffsetY),e.TransformationOptions.ResetOrigin&&(n+="&ResetOrigin="+e.TransformationOptions.ResetOrigin)),e.Palette)for(var i=0;i<e.Palette.length;i++)n+="&palette["+i+"]="+e.Palette[i];return n},e.prototype.createTemplateUrl=function(e,t){var n=this.confObject.url+"render/templates/"+e;if(t&&t.length>0){n+="?";for(var i=!0,o=0;o<t.length;o++)t[o].Name&&(i||(n+="&"),n+="Personalizations["+o+"].Name="+t[o].Name.replace(/\s/g,"%20"),i&&(i=!1)),t[o].Design&&(i||(n+="&"),n+="Personalizations["+o+"].Design="+t[o].Design.replace(/\s/g,"%20"),i&&(i=!1)),t[o].Text&&(i||(n+="&"),n+="Personalizations["+o+"].Text="+t[o].Text.replace(/\s/g,"%20"),i&&(i=!1)),t[o].TextColour&&(i||(n+="&"),n+="Personalizations["+o+"].TextColour="+t[o].TextColour.replace(/\s/g,"%20"),i&&(i=!1))}return n},e.prototype.createDesignUrl=function(e,t,n,i){var o=this.confObject.url+"render/Designs/"+e+"?",r=!0;if(t)for(var s=0;s<t.length;s++)r||(o+="&"),o+="Palette["+s+"]="+t[s],r=!1;if(n)for(var a=0;a<n.length;a++)r||(o+="&"),o+="Needles["+a+"]="+n[a],r=!1;return i&&(i.Angle&&(r||(o+="&"),o+="angle="+i.Angle,r=!1),i.OffsetX&&(r||(o+="&"),o+="OffsetX="+i.OffsetX,r=!1),i.OffsetY&&(r||(o+="&"),o+="OffsetY="+i.OffsetY,r=!1),i.ResetOrigin&&(r||(o+="&"),o+="ResetOrigin="+i.ResetOrigin,r=!1),i.Scale&&(r||(o+="&"),o+="Scale="+i.Scale,r=!1)),o},e.prototype.createCompoundUrl=function(e){var t=this.confObject.url+"render/Compound?",n=!0;if(e){if(e.CompoundElements){var i=this.addCompoundOtionsToUrl(e.CompoundElements,t,n);t=i.url,n=i.isFirstParameter}if(e.Layout&&(n||(t+="&"),t+="layout="+e.Layout,n=!1),e.MachineFormat&&(n||(t+="&"),t+="MachineFormat ="+e.MachineFormat,n=!1),e.Needles)for(var o=0;o<e.Needles.length;o++)n||(t+="&"),t+="needles["+o+"]="+e.Needles[o],n=!1;if(e.Palette)for(var o=0;o<e.Palette.length;o++)n||(t+="&"),t+="palette["+o+"]="+e.Palette[o],n=!1;e.Recipe&&(n||(t+="&"),t+="recipe="+e.Recipe.replace(/\s/g,"%20"),n=!1),e.StackedAlignment&&(n||(t+="&"),t+="StackedAlignment="+e.StackedAlignment.replace(/\s/g,"%20"),n=!1),e.StackedSpacing&&(n||(t+="&"),t+="StackedSpacing="+e.StackedSpacing,n=!1),e.TransformationOptions&&(e.TransformationOptions.Angle&&(n||(t+="&"),t+="angle="+e.TransformationOptions.Angle,n=!1),e.TransformationOptions.OffsetX&&(n||(t+="&"),t+="offsetX="+e.TransformationOptions.OffsetX,n=!1),e.TransformationOptions.OffsetY&&(n||(t+="&"),t+="offsetY="+e.TransformationOptions.OffsetY,n=!1),e.TransformationOptions.ResetOrigin&&(n||(t+="&"),t+="resetOrigin="+e.TransformationOptions.ResetOrigin,n=!1),e.TransformationOptions.Scale&&(n||(t+="&"),t+="scale="+e.TransformationOptions.Scale,n=!1))}return t},e.prototype.addCompoundOtionsToUrl=function(e,t,n){for(var i=0;i<e.length;i++){var o=!0;if(n||(t+="&"),e[i].Design&&e[i].Design.File){n||(t+="&"),t+="Elements["+i+"]=Designs/",n=!1;var o=!0;if(t+=e[i].Design.File+"%3f",e[i].Design.needles)for(var r=0;r<e[i].Design.needles.length;r++)o||(t+="%26"),t+="needles["+r+"]="+e[i].Design.needles[r],o=!1;if(e[i].Design.palette)for(var s=0;s<e[i].Design.palette.length;s++)o||(t+="%26"),t+="palette["+s+"]="+e[i].Design.palette[s],o=!1}e[i].Letteting&&(n||(t+="&"),t+="Elements["+i+"]=Lettering%3fText=",n=!1,t=this.addLetteringToCompoundUrl(e[i].Letteting,t,o))}return{url:t,isFirstParameter:n}},e.prototype.addLetteringToCompoundUrl=function(e,t){var n=e.Text?e.Text:"ABC";return t+=n,e.Decoration&&(t+="%26decoration="+e.Decoration),e.Envelope&&(t+="%26envelope="+e.Envelope),e.Font&&(t+="%26font="+e.Font),e.Height&&(t+="%26height="+e.Height),e.Justification&&(t+="%26Justification="+e.Justification),e.MachineFormat&&(t+="%26MachineFormat="+e.MachineFormat),e.Neendle&&(t+="%26needle="+e.Neendle),e.Recipe&&(t+="%26Recipe="+e.Recipe),e.TransformationOptions&&(e.TransformationOptions.Angle&&(t+="%26Angle="+e.TransformationOptions.Angle),e.TransformationOptions.OffsetX&&(t+="%26OffsetX="+e.TransformationOptions.OffsetX),e.TransformationOptions.OffsetY&&(t+="%26OffsetY="+e.TransformationOptions.OffsetY),e.TransformationOptions.ResetOrigin&&(t+="%26ResetOrigin="+e.TransformationOptions.ResetOrigin),e.TransformationOptions.Scale&&(t+="%26Scale="+e.TransformationOptions.Scale)),e.Type&&(t+="%26Type="+e.Type),e.WidthCompression&&(t+="%26WidthCompression="+e.WidthCompression),e.X1&&(t+="%26X1="+e.X1),e.X2&&(t+="%26X2="+e.X2),e.Y1&&(t+="%26Y1="+e.Y1),t},e}();e.ImageRenderer=t}(Renderer||(Renderer={}));var StitchEngine;!function(e){var t=function(){function e(e){"/"!=e.substr(e.length-1)&&(e+="/"),e+="1/",this.url=e}return e}();e.SEConfigObject=t}(StitchEngine||(StitchEngine={}));var StitchEngine;!function(e){var t=function(){function e(e){this.confObject=e}return e.prototype.getImageRenderer=function(){return new Renderer.ImageRenderer(this.confObject)},e.prototype.getAssetsManager=function(){return this.assetsManager||(this.assetsManager=new Assets.AssetsManager(this.confObject)),this.assetsManager},e}();e.SEFactory=t}(StitchEngine||(StitchEngine={}));