var Assets;!function(t){var e=function(){function t(t){this.configObject=t}return t.prototype.getFonts=function(t,e){var n=new Options.getFontOptions,r=this.createGetFontUrl(n);this.handleRequest(r,t,e)},t.prototype.getFontsToJsonFormat=function(t,e,n){var r=this.createGetFontUrl(t,"json");this.handleRequest(r,e,n)},t.prototype.getFontsToXmlFormat=function(t,e,n){var r=this.createGetFontUrl(t);this.handleRequest(r,e,n)},t.prototype.getRecipesToXml=function(t,e,n){var r=new Options.getRecipesOptions;n&&(r.IsSorted=n);var o=this.createGetRecipesUrl(r);this.handleRequest(o,t,e)},t.prototype.getRecipesToJson=function(t,e,n){var r=new Options.getRecipesOptions;r.Format="json",n&&(r.IsSorted=n);var o=this.createGetRecipesUrl(r);this.handleRequest(o,t,e)},t.prototype.createGetFontUrl=function(t,e){"undefined"==typeof e&&(e="xml");var n=this.configObject.url+"List/Fonts?format="+e;return t.Type&&(n+="&type="+t.Type),t.IsSorted&&(n+="&issorted="+t.IsSorted),n},t.prototype.createGetRecipesUrl=function(t){var e=t.Format?t.Format:"xml",n=this.configObject.url+"List/Recipes?format="+e;return t.IsSorted&&(n+="&issorted="+t.IsSorted),n},t.prototype.handleRequest=function(t,e,n){var r=this.createCORSRequest("GET",t);r?r.send():n("Your browser deos not support ajax calls"),r.onreadystatechange=function(){if(4==r.readyState&&200==r.status){var t=r.response;e&&e(t)}else 4==r.readyState&&404==r.status?n&&n("Server not found"):4==r.readyState&&500==r.status&&n&&n("Internal server error")}},t.prototype.createCORSRequest=function(t,e){var n,r=new XMLHttpRequest;if("withCredentials"in r)n=r,n.open(t,e,!0);else if("undefined"!=typeof XDomainRequest){var o=new XDomainRequest;n=o,r.open(t,e)}else n=null;return n},t}();t.AssetsManager=e}(Assets||(Assets={}));var Options;!function(t){var e=function(){function t(){this.Text=null,this.Type=null,this.Font=null,this.Height=null,this.WidthCompression=null,this.Justification=null,this.Envelope=null,this.Recipe=null,this.X1=null,this.X2=null,this.Y1=null,this.Y2=null,this.Decoration=null,this.Neendle=null,this.MachineFormat=null,this.TransformationOptions=null,this.Palette=null}return t}();t.LetteringOptions=e;var n=function(){function t(){this.Angle=null,this.Scale=null,this.OffsetX=null,this.OffsetY=null,this.ResetOrigin=null}return t}();t.TransformationOptions=n;var r=function(){function t(){this.IsSorted=null,this.Type=null}return t}();t.getFontOptions=r;var o=function(){function t(){this.Format=null,this.IsSorted=null}return t}();t.getRecipesOptions=o;var i=function(){function t(){this.Design=null,this.Name=null,this.Text=null,this.TextColour=null}return t}();t.Peronalization=i;var s=function(){function t(){this.Layout=null,this.MachineFormat=null,this.Needles=null,this.Palette=null,this.Recipe=null,this.StackedAlignment=null,this.StackedSpacing=null,this.TransformationOptions=null,this.CompoundElements=null}return t}();t.CompoundOptions=s;var a=function(){function t(){this.File=null,this.palette=null,this.needles=null}return t}();t.DesignOptions=a;var l=function(){function t(){this.Design=null,this.Letteting=null}return t}();t.CompoundElements=l}(Options||(Options={}));var Renderer;!function(t){var e=function(){function t(t,e){this.confObject=t,this.urlConstructor=e}return t.prototype.lettering=function(t,e,n,r){var o=!1;if(t.Palette)for(var i=0;i<t.Palette.length;i++)if(!/(^[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(t.Palette[i])){o=!0;break}o&&r&&r("Invalid color"),o&&(t.Palette=null);var s=this.urlConstructor.createLetteringUrl(this.confObject.url,t);if(e){var a=document.getElementById(e);a&&a.setAttribute("src",s)}n&&n(s)},t.prototype.letteringTextFontColor=function(t,e,n,r,o,i){var s=new Options.LetteringOptions;s.Text=t,s.Font=e;var a=!1;if(n)for(var l=0;l<n.length;l++)if(!/(^[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(n[l])){a=!0;break}a&&i("Invalid color."),n&&!a&&(s.Neendle=0,s.Palette=n),this.lettering(s,r,o,null)},t.prototype.letteringBase64=function(t,e,n){var r=!1;if(t.Palette)for(var o=0;o<t.Palette.length;o++)if(!/(^[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(t.Palette[o])){r=!0;break}if(r&&n&&n("Invalid colors"),!r){var i=this.urlConstructor.createLetteringUrl(this.confObject.url,t);this.GetBase64Image(i,e,n)}},t.prototype.letteringTextFontColorBase64=function(t,e,n,r,o){var i=new Options.LetteringOptions;i.Text=t,i.Font=e;var s=!1;if(n)for(var a=0;a<n.length;a++)if(!/(^[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(n[a])){s=!0;break}s&&o&&o("Invalid color."),n&&!s&&(i.Neendle=0,i.Palette=n);var l=this.urlConstructor.createLetteringUrl(this.confObject.url,i);this.GetBase64Image(l,r,o)},t.prototype.template=function(t,e,n,r){var o=this.urlConstructor.createTemplateUrl(this.confObject.url,t,r);if(e){var i=document.getElementById(e);i&&i.setAttribute("src",o)}n&&n(o)},t.prototype.templateBase64=function(t,e,n,r){var o=this.urlConstructor.createTemplateUrl(this.confObject.url,t,r);this.GetBase64Image(o,e,n)},t.prototype.design=function(t,e,n,r,o,i,s){var a=!1;if(n)for(var l=0;l<n.length;l++)if(!/(^[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(n[l])){a=!0;break}a&&s&&s("Invalid color");var c=a?null:n,u=this.urlConstructor.createDesignUrl(this.confObject.url,t,c,r,o);if(e){var f=document.getElementById(e);f&&f.setAttribute("src",u)}i&&i(u)},t.prototype.designChangePalette=function(t,e,n,r,o){this.design(t,e,n,null,null,r,o)},t.prototype.designChangeNeedles=function(t,e,n,r,o){this.design(t,e,null,n,null,r,o)},t.prototype.designBase64=function(t,e,n,r,o,i){var s=!1;if(e)for(var a=0;a<e.length;a++)if(!/(^[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(e[a])){s=!0;break}if(s&&i&&i("Invalid color"),!s){var l=this.urlConstructor.createDesignUrl(this.confObject.url,t,e,n,r);this.GetBase64Image(l,o,i)}},t.prototype.designChangePaletteBase64=function(t,e,n,r){var o=!1;if(e)for(var i=0;i<e.length;i++)if(!/(^[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(e[i])){o=!0;break}if(o&&r&&r("Invalid color"),!o){var s=this.urlConstructor.createDesignUrl(this.confObject.url,t,e,null,null);this.GetBase64Image(s,n,r)}},t.prototype.designChangeNeedlesBase64=function(t,e,n,r){var o=this.urlConstructor.createDesignUrl(this.confObject.url,t,null,e,null);this.GetBase64Image(o,n,r)},t.prototype.compound=function(t,e){var n=this.urlConstructor.createCompoundUrl(this.confObject.url,t);if(e){var r=document.getElementById(e);r&&r.setAttribute("src",n)}},t.prototype.compoundBase64=function(t,e,n){var r=this.urlConstructor.createCompoundUrl(this.confObject.url,t);this.GetBase64Image(r,e,n)},t.prototype.GetBase64Image=function(t,e,n){var r=new Image,o="";r.src=t,r.onload=function(){var t=document.createElement("canvas");t.width=r.width,t.height=r.height;var n=t.getContext("2d");n.drawImage(r,0,0),o=t.toDataURL("image/png"),e&&e(o.replace(/^data:image\/(png|jpg);base64,/,""))},r.onerror=function(){n&&n("Image could not be loaded.")}},t}();t.ImageRenderer=e}(Renderer||(Renderer={}));var StitchEngine;!function(t){var e=function(){function t(t){"/"!=t.substr(t.length-1)&&(t+="/"),t+="1/",this.url=t}return t}();t.SEConfigObject=e}(StitchEngine||(StitchEngine={}));var StitchEngine;!function(t){var e=function(){function t(t){this.confObject=t}return t.prototype.getImageRenderer=function(){return new Renderer.ImageRenderer(this.confObject,new Utils.UrlConstructor)},t.prototype.getAssetsManager=function(){return this.assetsManager||(this.assetsManager=new Assets.AssetsManager(this.confObject)),this.assetsManager},t}();t.SEFactory=e}(StitchEngine||(StitchEngine={}));var Utils;!function(t){var e=function(){function t(){}return t.prototype.createLetteringUrl=function(t,e){var n=e.Text?e.Text:"ABC";if(t+="render/Lettering?Text="+n,e.Type&&(t+="&Type="+e.Type),e.Font&&(t+="&Font="+e.Font.replace(/\s/g,"%20")),e.Height&&(t+="&height="+e.Height),e.WidthCompression&&(t+="&WidthCompression="+e.WidthCompression),e.Justification&&(t+="&Justification="+e.Justification),e.Envelope&&(t+="&Envelope="+e.Envelope),e.Decoration&&"monogram"==e.Type.toLowerCase()&&(t+="&Decoration="+e.Decoration),e.Recipe&&(t+="&Recipe="+e.Recipe.replace(/\s/g,"%20")),e.Neendle&&(t+="&Needle="+e.Neendle),e.MachineFormat&&(t+="&MachineFormat="+e.MachineFormat.replace(/\s/g,"%20")),e.X1&&(t+="&X1="+e.X1),e.X2&&(t+="&X2="+e.X2),e.Y1&&(t+="&Y1="+e.Y1),e.Y2&&(t+="&Y2="+e.Y2),e.TransformationOptions&&(e.TransformationOptions.Angle&&(t+="&Angle="+e.TransformationOptions.Angle),e.TransformationOptions.Scale&&(t+="&Scale="+e.TransformationOptions.Scale),e.TransformationOptions.OffsetX&&(t+="&OffsetX="+e.TransformationOptions.OffsetX),e.TransformationOptions.OffsetY&&(t+="&OffsetY="+e.TransformationOptions.OffsetY),e.TransformationOptions.ResetOrigin&&(t+="&ResetOrigin="+e.TransformationOptions.ResetOrigin)),e.Palette)for(var r=0;r<e.Palette.length;r++)t+="&palette["+r+"]="+e.Palette[r];return t},t.prototype.createTemplateUrl=function(t,e,n){if(t+="render/templates/"+e,n&&n.length>0){t+="?";for(var r=!0,o=0;o<n.length;o++)n[o].Name&&(r||(t+="&"),t+="Personalizations["+o+"].Name="+n[o].Name.replace(/\s/g,"%20"),r&&(r=!1)),n[o].Design&&(r||(t+="&"),t+="Personalizations["+o+"].Design="+n[o].Design.replace(/\s/g,"%20"),r&&(r=!1)),n[o].Text&&(r||(t+="&"),t+="Personalizations["+o+"].Text="+n[o].Text.replace(/\s/g,"%20"),r&&(r=!1)),n[o].TextColour&&(r||(t+="&"),t+="Personalizations["+o+"].TextColour="+n[o].TextColour.replace(/\s/g,"%20"),r&&(r=!1))}return t},t.prototype.createDesignUrl=function(t,e,n,r,o){t+="render/Designs/"+e+"?";var i=!0;if(n)for(var s=0;s<n.length;s++)i||(t+="&"),t+="Palette["+s+"]="+n[s],i=!1;if(r)for(var a=0;a<r.length;a++)i||(t+="&"),t+="Needles["+a+"]="+r[a],i=!1;return o&&(o.Angle&&(i||(t+="&"),t+="angle="+o.Angle,i=!1),o.OffsetX&&(i||(t+="&"),t+="OffsetX="+o.OffsetX,i=!1),o.OffsetY&&(i||(t+="&"),t+="OffsetY="+o.OffsetY,i=!1),o.ResetOrigin&&(i||(t+="&"),t+="ResetOrigin="+o.ResetOrigin,i=!1),o.Scale&&(i||(t+="&"),t+="Scale="+o.Scale,i=!1)),t},t.prototype.createCompoundUrl=function(t,e){t+="render/Compound?";var n=!0;if(e){if(e.CompoundElements){var r=this.addCompoundOtionsToUrl(e.CompoundElements,t,n);t=r.url,n=r.isFirstParameter}if(e.Layout&&(n||(t+="&"),t+="layout="+e.Layout,n=!1),e.MachineFormat&&(n||(t+="&"),t+="MachineFormat ="+e.MachineFormat,n=!1),e.Needles)for(var o=0;o<e.Needles.length;o++)n||(t+="&"),t+="needles["+o+"]="+e.Needles[o],n=!1;if(e.Palette)for(var o=0;o<e.Palette.length;o++)n||(t+="&"),t+="palette["+o+"]="+e.Palette[o],n=!1;e.Recipe&&(n||(t+="&"),t+="recipe="+e.Recipe.replace(/\s/g,"%20"),n=!1),e.StackedAlignment&&(n||(t+="&"),t+="StackedAlignment="+e.StackedAlignment.replace(/\s/g,"%20"),n=!1),e.StackedSpacing&&(n||(t+="&"),t+="StackedSpacing="+e.StackedSpacing,n=!1),e.TransformationOptions&&(e.TransformationOptions.Angle&&(n||(t+="&"),t+="angle="+e.TransformationOptions.Angle,n=!1),e.TransformationOptions.OffsetX&&(n||(t+="&"),t+="offsetX="+e.TransformationOptions.OffsetX,n=!1),e.TransformationOptions.OffsetY&&(n||(t+="&"),t+="offsetY="+e.TransformationOptions.OffsetY,n=!1),e.TransformationOptions.ResetOrigin&&(n||(t+="&"),t+="resetOrigin="+e.TransformationOptions.ResetOrigin,n=!1),e.TransformationOptions.Scale&&(n||(t+="&"),t+="scale="+e.TransformationOptions.Scale,n=!1))}return t},t.prototype.addCompoundOtionsToUrl=function(t,e,n){for(var r=0;r<t.length;r++){var o=!0;if(n||(e+="&"),t[r].Design&&t[r].Design.File){n||(e+="&"),e+="Elements["+r+"]=Designs/",n=!1;var o=!0;if(e+=t[r].Design.File+"%3f",t[r].Design.needles)for(var i=0;i<t[r].Design.needles.length;i++)o||(e+="%26"),e+="needles["+i+"]="+t[r].Design.needles[i],o=!1;if(t[r].Design.palette)for(var s=0;s<t[r].Design.palette.length;s++)o||(e+="%26"),e+="palette["+s+"]="+t[r].Design.palette[s],o=!1}t[r].Letteting&&(n||(e+="&"),e+="Elements["+r+"]=Lettering%3fText=",n=!1,e=this.addLetteringToCompoundUrl(t[r].Letteting,e,o))}return{url:e,isFirstParameter:n}},t.prototype.addLetteringToCompoundUrl=function(t,e){var n=t.Text?t.Text:"ABC";return e+=n,t.Decoration&&(e+="%26decoration="+t.Decoration),t.Envelope&&(e+="%26envelope="+t.Envelope),t.Font&&(e+="%26font="+t.Font),t.Height&&(e+="%26height="+t.Height),t.Justification&&(e+="%26Justification="+t.Justification),t.MachineFormat&&(e+="%26MachineFormat="+t.MachineFormat),t.Neendle&&(e+="%26needle="+t.Neendle),t.Recipe&&(e+="%26Recipe="+t.Recipe),t.TransformationOptions&&(t.TransformationOptions.Angle&&(e+="%26Angle="+t.TransformationOptions.Angle),t.TransformationOptions.OffsetX&&(e+="%26OffsetX="+t.TransformationOptions.OffsetX),t.TransformationOptions.OffsetY&&(e+="%26OffsetY="+t.TransformationOptions.OffsetY),t.TransformationOptions.ResetOrigin&&(e+="%26ResetOrigin="+t.TransformationOptions.ResetOrigin),t.TransformationOptions.Scale&&(e+="%26Scale="+t.TransformationOptions.Scale)),t.Type&&(e+="%26Type="+t.Type),t.WidthCompression&&(e+="%26WidthCompression="+t.WidthCompression),t.X1&&(e+="%26X1="+t.X1),t.X2&&(e+="%26X2="+t.X2),t.Y1&&(e+="%26Y1="+t.Y1),e},t}();t.UrlConstructor=e}(Utils||(Utils={}));