var Assets;!function(t){var e=function(){function t(t){this.configObject=t}return t.prototype.getFonts=function(t,e){var n=new Options.getFontOptions,i=this.createGetFontUrl(n);this.handleRequest(i,t,e)},t.prototype.getFontsToJsonFormat=function(t,e,n){var i=this.createGetFontUrl(t,"json");this.handleRequest(i,e,n)},t.prototype.getFontsToXmlFormat=function(t,e,n){var i=this.createGetFontUrl(t);this.handleRequest(i,e,n)},t.prototype.getRecipesToXml=function(t,e,n){var i=new Options.getRecipesOptions;n&&(i.IsSorted=n);var r=this.createGetRecipesUrl(i);this.handleRequest(r,t,e)},t.prototype.getRecipesToJson=function(t,e,n){var i=new Options.getRecipesOptions;i.Format="json",n&&(i.IsSorted=n);var r=this.createGetRecipesUrl(i);this.handleRequest(r,t,e)},t.prototype.createGetFontUrl=function(t,e){"undefined"==typeof e&&(e="xml");var n=this.configObject.url+"List/Fonts?format="+e;return t.Type&&(n+="&type="+t.Type),t.IsSorted&&(n+="&issorted="+t.IsSorted),n},t.prototype.createGetRecipesUrl=function(t){var e=t.Format?t.Format:"xml",n=this.configObject.url+"List/Recipes?format="+e;return t.IsSorted&&(n+="&issorted="+t.IsSorted),n},t.prototype.handleRequest=function(t,e,n){var i=this.createCORSRequest("GET",t);i?i.send():n("Your browser deos not support ajax calls"),i.onreadystatechange=function(){if(4==i.readyState&&200==i.status){var t=i.response;e&&e(t)}else 4==i.readyState&&404==i.status?n&&n("Server not found"):4==i.readyState&&500==i.status&&n&&n("Internal server error")}},t.prototype.createCORSRequest=function(t,e){var n,i=new XMLHttpRequest;if("withCredentials"in i)n=i,n.open(t,e,!0);else if("undefined"!=typeof XDomainRequest){var r=new XDomainRequest;n=r,i.open(t,e)}else n=null;return n},t}();t.AssetsManager=e}(Assets||(Assets={}));var Options;!function(t){var e=function(){function t(){this.Format=null,this.Background=null,this.ImageHeight=null,this.ImageWidth=null,this.DPI=null,this.IsSquare=null,this.Padding=null}return t}();t.RenderingOptions=e;var n=function(){function t(){this.Text=null,this.Type=null,this.Font=null,this.Height=null,this.WidthCompression=null,this.Justification=null,this.Envelope=null,this.Recipe=null,this.X1=null,this.X2=null,this.Y1=null,this.Y2=null,this.Decoration=null,this.Neendle=null,this.MachineFormat=null,this.TransformationOptions=null,this.Palette=null,this.RenderingOptions=null}return t}();t.LetteringOptions=n;var i=function(){function t(){this.Angle=null,this.Scale=null,this.OffsetX=null,this.OffsetY=null,this.ResetOrigin=null}return t}();t.TransformationOptions=i;var r=function(){function t(){this.IsSorted=null,this.Type=null}return t}();t.getFontOptions=r;var o=function(){function t(){this.Format=null,this.IsSorted=null}return t}();t.getRecipesOptions=o;var s=function(){function t(){this.Design=null,this.Name=null,this.Text=null,this.TextColour=null}return t}();t.Peronalization=s;var a=function(){function t(){this.Layout=null,this.MachineFormat=null,this.Needles=null,this.Palette=null,this.Recipe=null,this.StackedAlignment=null,this.StackedSpacing=null,this.TransformationOptions=null,this.CompoundElements=null}return t}();t.CompoundOptions=a;var l=function(){function t(){this.File=null,this.palette=null,this.needles=null}return t}();t.DesignOptions=l;var u=function(){function t(){this.Design=null,this.Letteting=null}return t}();t.CompoundElements=u}(Options||(Options={}));var Renderer;!function(t){var e=function(){function t(t,e){this.confObject=t,this.urlConstructor=e}return t.prototype.lettering=function(t,e,n,i){var r=!1;if(t.Palette)for(var o=0;o<t.Palette.length;o++)if(!/(^[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(t.Palette[o])){r=!0;break}r&&i&&i("Invalid color"),r&&(t.Palette=null);var s=this.urlConstructor.createLetteringUrl(this.confObject.url,t);if(e){var a=document.getElementById(e);a&&a.setAttribute("src",s)}n&&n(s)},t.prototype.letteringTextFontColor=function(t,e,n,i,r,o){var s=new Options.LetteringOptions;s.Text=t,s.Font=e;var a=!1;if(n)for(var l=0;l<n.length;l++)if(!/(^[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(n[l])){a=!0;break}a&&o("Invalid color."),n&&!a&&(s.Neendle=0,s.Palette=n),this.lettering(s,i,r,null)},t.prototype.letteringBase64=function(t,e,n){var i=!1;if(t.Palette)for(var r=0;r<t.Palette.length;r++)if(!/(^[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(t.Palette[r])){i=!0;break}if(i&&n&&n("Invalid colors"),!i){var o=this.urlConstructor.createLetteringUrl(this.confObject.url,t);this.GetBase64Image(o,e,n)}},t.prototype.letteringTextFontColorBase64=function(t,e,n,i,r){var o=new Options.LetteringOptions;o.Text=t,o.Font=e;var s=!1;if(n)for(var a=0;a<n.length;a++)if(!/(^[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(n[a])){s=!0;break}s&&r&&r("Invalid color."),n&&!s&&(o.Neendle=0,o.Palette=n);var l=this.urlConstructor.createLetteringUrl(this.confObject.url,o);this.GetBase64Image(l,i,r)},t.prototype.template=function(t,e,n,i){var r=this.urlConstructor.createTemplateUrl(this.confObject.url,t,i);if(e){var o=document.getElementById(e);o&&o.setAttribute("src",r)}n&&n(r)},t.prototype.templateBase64=function(t,e,n,i){var r=this.urlConstructor.createTemplateUrl(this.confObject.url,t,i);this.GetBase64Image(r,e,n)},t.prototype.design=function(t,e,n,i,r,o,s){var a=!1;if(n)for(var l=0;l<n.length;l++)if(!/(^[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(n[l])){a=!0;break}a&&s&&s("Invalid color");var u=a?null:n,c=this.urlConstructor.createDesignUrl(this.confObject.url,t,u,i,r);if(e){var f=document.getElementById(e);f&&f.setAttribute("src",c)}o&&o(c)},t.prototype.designChangePalette=function(t,e,n,i,r){this.design(t,e,n,null,null,i,r)},t.prototype.designChangeNeedles=function(t,e,n,i,r){this.design(t,e,null,n,null,i,r)},t.prototype.designBase64=function(t,e,n,i,r,o){var s=!1;if(e)for(var a=0;a<e.length;a++)if(!/(^[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(e[a])){s=!0;break}if(s&&o&&o("Invalid color"),!s){var l=this.urlConstructor.createDesignUrl(this.confObject.url,t,e,n,i);this.GetBase64Image(l,r,o)}},t.prototype.designChangePaletteBase64=function(t,e,n,i){var r=!1;if(e)for(var o=0;o<e.length;o++)if(!/(^[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(e[o])){r=!0;break}if(r&&i&&i("Invalid color"),!r){var s=this.urlConstructor.createDesignUrl(this.confObject.url,t,e,null,null);this.GetBase64Image(s,n,i)}},t.prototype.designChangeNeedlesBase64=function(t,e,n,i){var r=this.urlConstructor.createDesignUrl(this.confObject.url,t,null,e,null);this.GetBase64Image(r,n,i)},t.prototype.compound=function(t,e){var n=this.urlConstructor.createCompoundUrl(this.confObject.url,t);if(e){var i=document.getElementById(e);i&&i.setAttribute("src",n)}},t.prototype.compoundBase64=function(t,e,n){var i=this.urlConstructor.createCompoundUrl(this.confObject.url,t);this.GetBase64Image(i,e,n)},t.prototype.GetBase64Image=function(t,e,n){var i=new Image,r="";i.src=t,i.onload=function(){var t=document.createElement("canvas");t.width=i.width,t.height=i.height;var n=t.getContext("2d");n.drawImage(i,0,0),r=t.toDataURL("image/png"),e&&e(r.replace(/^data:image\/(png|jpg);base64,/,""))},i.onerror=function(){n&&n("Image could not be loaded.")}},t}();t.ImageRenderer=e}(Renderer||(Renderer={}));var StitchEngine;!function(t){var e=function(){function t(t){"/"!=t.substr(t.length-1)&&(t+="/"),t+="1/",this.url=t}return t}();t.SEConfigObject=e}(StitchEngine||(StitchEngine={}));var StitchEngine;!function(t){var e=function(){function t(t){this.confObject=t}return t.prototype.getImageRenderer=function(){return new Renderer.ImageRenderer(this.confObject,new Utils.UrlConstructor)},t.prototype.getAssetsManager=function(){return this.assetsManager||(this.assetsManager=new Assets.AssetsManager(this.confObject)),this.assetsManager},t}();t.SEFactory=e}(StitchEngine||(StitchEngine={}));var Utils;!function(t){var e=function(){function t(){}return t.prototype.createLetteringUrl=function(t,e){var n=e.Text?e.Text:"ABC";if(t+="render/Lettering?Text="+n,e.Type&&(t+="&Type="+e.Type),e.Font&&(t+="&Font="+e.Font.replace(/\s/g,"%20")),e.Height&&(t+="&height="+e.Height),e.WidthCompression&&(t+="&WidthCompression="+e.WidthCompression),e.Justification&&(t+="&Justification="+e.Justification),e.Envelope&&(t+="&Envelope="+e.Envelope),e.Decoration&&"monogram"==e.Type.toLowerCase()&&(t+="&Decoration="+e.Decoration),e.Recipe&&(t+="&Recipe="+e.Recipe.replace(/\s/g,"%20")),e.Neendle&&(t+="&Needle="+e.Neendle),e.MachineFormat&&(t+="&MachineFormat="+e.MachineFormat.replace(/\s/g,"%20")),e.X1&&(t+="&X1="+e.X1),e.X2&&(t+="&X2="+e.X2),e.Y1&&(t+="&Y1="+e.Y1),e.Y2&&(t+="&Y2="+e.Y2),e.TransformationOptions&&(e.TransformationOptions.Angle&&(t+="&Angle="+e.TransformationOptions.Angle),e.TransformationOptions.Scale&&(t+="&Scale="+e.TransformationOptions.Scale),e.TransformationOptions.OffsetX&&(t+="&OffsetX="+e.TransformationOptions.OffsetX),e.TransformationOptions.OffsetY&&(t+="&OffsetY="+e.TransformationOptions.OffsetY),e.TransformationOptions.ResetOrigin&&(t+="&ResetOrigin="+e.TransformationOptions.ResetOrigin)),e.Palette)for(var i=0;i<e.Palette.length;i++)t+="&palette["+i+"]="+e.Palette[i];return e.RenderingOptions&&(e.RenderingOptions.Background&&(t+="&background="+e.RenderingOptions.Background),e.RenderingOptions.DPI&&(t+="&dpi="+e.RenderingOptions.DPI),e.RenderingOptions.Format&&(t+="&Format="+e.RenderingOptions.Format),e.RenderingOptions.ImageHeight&&(t+="&ImageHeight="+e.RenderingOptions.ImageHeight),e.RenderingOptions.ImageWidth&&(t+="&ImageWidth="+e.RenderingOptions.ImageWidth),e.RenderingOptions.IsSquare&&(t+="&IsSquare="+e.RenderingOptions.IsSquare),e.RenderingOptions.Padding&&(t+="&Padding="+e.RenderingOptions.Padding)),t},t.prototype.createTemplateUrl=function(t,e,n){if(t+="render/templates/"+e,n&&n.length>0){t+="?";for(var i=!0,r=0;r<n.length;r++)n[r].Name&&(i||(t+="&"),t+="Personalizations["+r+"].Name="+n[r].Name.replace(/\s/g,"%20"),i&&(i=!1)),n[r].Design&&(i||(t+="&"),t+="Personalizations["+r+"].Design="+n[r].Design.replace(/\s/g,"%20"),i&&(i=!1)),n[r].Text&&(i||(t+="&"),t+="Personalizations["+r+"].Text="+n[r].Text.replace(/\s/g,"%20"),i&&(i=!1)),n[r].TextColour&&(i||(t+="&"),t+="Personalizations["+r+"].TextColour="+n[r].TextColour.replace(/\s/g,"%20"),i&&(i=!1))}return t},t.prototype.createDesignUrl=function(t,e,n,i,r){t+="render/Designs/"+e+"?";var o=!0;if(n)for(var s=0;s<n.length;s++)o||(t+="&"),t+="Palette["+s+"]="+n[s],o=!1;if(i)for(var a=0;a<i.length;a++)o||(t+="&"),t+="Needles["+a+"]="+i[a],o=!1;return r&&(r.Angle&&(o||(t+="&"),t+="angle="+r.Angle,o=!1),r.OffsetX&&(o||(t+="&"),t+="OffsetX="+r.OffsetX,o=!1),r.OffsetY&&(o||(t+="&"),t+="OffsetY="+r.OffsetY,o=!1),r.ResetOrigin&&(o||(t+="&"),t+="ResetOrigin="+r.ResetOrigin,o=!1),r.Scale&&(o||(t+="&"),t+="Scale="+r.Scale,o=!1)),t},t.prototype.createCompoundUrl=function(t,e){t+="render/Compound?";var n=!0;if(e){if(e.CompoundElements){var i=this.addCompoundOtionsToUrl(e.CompoundElements,t,n);t=i.url,n=i.isFirstParameter}if(e.Layout&&(n||(t+="&"),t+="layout="+e.Layout,n=!1),e.MachineFormat&&(n||(t+="&"),t+="MachineFormat ="+e.MachineFormat,n=!1),e.Needles)for(var r=0;r<e.Needles.length;r++)n||(t+="&"),t+="needles["+r+"]="+e.Needles[r],n=!1;if(e.Palette)for(var r=0;r<e.Palette.length;r++)n||(t+="&"),t+="palette["+r+"]="+e.Palette[r],n=!1;e.Recipe&&(n||(t+="&"),t+="recipe="+e.Recipe.replace(/\s/g,"%20"),n=!1),e.StackedAlignment&&(n||(t+="&"),t+="StackedAlignment="+e.StackedAlignment.replace(/\s/g,"%20"),n=!1),e.StackedSpacing&&(n||(t+="&"),t+="StackedSpacing="+e.StackedSpacing,n=!1),e.TransformationOptions&&(e.TransformationOptions.Angle&&(n||(t+="&"),t+="angle="+e.TransformationOptions.Angle,n=!1),e.TransformationOptions.OffsetX&&(n||(t+="&"),t+="offsetX="+e.TransformationOptions.OffsetX,n=!1),e.TransformationOptions.OffsetY&&(n||(t+="&"),t+="offsetY="+e.TransformationOptions.OffsetY,n=!1),e.TransformationOptions.ResetOrigin&&(n||(t+="&"),t+="resetOrigin="+e.TransformationOptions.ResetOrigin,n=!1),e.TransformationOptions.Scale&&(n||(t+="&"),t+="scale="+e.TransformationOptions.Scale,n=!1))}return t},t.prototype.addCompoundOtionsToUrl=function(t,e,n){for(var i=0;i<t.length;i++){var r=!0;if(n||(e+="&"),t[i].Design&&t[i].Design.File){n||(e+="&"),e+="Elements["+i+"]=Designs/",n=!1;var r=!0;if(e+=t[i].Design.File+"%3f",t[i].Design.needles)for(var o=0;o<t[i].Design.needles.length;o++)r||(e+="%26"),e+="needles["+o+"]="+t[i].Design.needles[o],r=!1;if(t[i].Design.palette)for(var s=0;s<t[i].Design.palette.length;s++)r||(e+="%26"),e+="palette["+s+"]="+t[i].Design.palette[s],r=!1}t[i].Letteting&&(n||(e+="&"),e+="Elements["+i+"]=Lettering%3fText=",n=!1,e=this.addLetteringToCompoundUrl(t[i].Letteting,e,r))}return{url:e,isFirstParameter:n}},t.prototype.addLetteringToCompoundUrl=function(t,e){var n=t.Text?t.Text:"ABC";return e+=n,t.Decoration&&(e+="%26decoration="+t.Decoration),t.Envelope&&(e+="%26envelope="+t.Envelope),t.Font&&(e+="%26font="+t.Font),t.Height&&(e+="%26height="+t.Height),t.Justification&&(e+="%26Justification="+t.Justification),t.MachineFormat&&(e+="%26MachineFormat="+t.MachineFormat),t.Neendle&&(e+="%26needle="+t.Neendle),t.Palette&&(e+="%26palette="+t.Palette),t.Recipe&&(e+="%26Recipe="+t.Recipe),t.TransformationOptions&&(t.TransformationOptions.Angle&&(e+="%26Angle="+t.TransformationOptions.Angle),t.TransformationOptions.OffsetX&&(e+="%26OffsetX="+t.TransformationOptions.OffsetX),t.TransformationOptions.OffsetY&&(e+="%26OffsetY="+t.TransformationOptions.OffsetY),t.TransformationOptions.ResetOrigin&&(e+="%26ResetOrigin="+t.TransformationOptions.ResetOrigin),t.TransformationOptions.Scale&&(e+="%26Scale="+t.TransformationOptions.Scale)),t.Type&&(e+="%26Type="+t.Type),t.WidthCompression&&(e+="%26WidthCompression="+t.WidthCompression),t.X1&&(e+="%26X1="+t.X1),t.X2&&(e+="%26X2="+t.X2),t.Y1&&(e+="%26Y1="+t.Y1),e},t}();t.UrlConstructor=e}(Utils||(Utils={}));